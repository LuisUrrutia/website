---
import { getCollection } from "astro:content";
import BlogPostPage from "@/views/BlogPostPage.astro";

export async function getStaticPaths() {
	const posts = await getCollection("blog", ({ data }) => {
		return data.lang === "es" && !data.draft;
	});

	const allPosts = await getCollection("blog");

	return posts.map((post) => {
		// Remove the locale prefix from the slug
		const slug = post.id.replace(/^es\//, "");

		// Find the translated version
		const translatedPost = allPosts.find(
			(p) =>
				p.data.lang === "en" &&
				p.data.translationSlug === post.data.translationSlug &&
				p.id !== post.id,
		);

		return {
			params: { slug },
			props: { post, translatedPost },
		};
	});
}

const { post, translatedPost } = Astro.props;
---

<BlogPostPage post={post} translatedPost={translatedPost} />
