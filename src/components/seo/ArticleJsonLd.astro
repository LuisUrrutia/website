---
/**
 * ArticleJsonLd - Renders JSON-LD Article schema for blog posts.
 *
 * Generates Article/BlogPosting schema with author, dates,
 * and article metadata for better SEO on blog content.
 */
import { buildPersonEntity } from "@/data/seo";
import { toISOWithTimezone } from "@/lib/formatters";

interface Props {
	/** Article title */
	title: string;
	/** Article description/excerpt */
	description: string;
	/** Full URL of the article */
	url: string;
	/** Site URL for building person entity */
	siteUrl: string;
	/** Published date */
	publishedTime: Date;
	/** Modified date (optional) */
	modifiedTime?: Date;
	/** Article cover image URL (absolute URL) */
	image: string;
	/** Article tags/keywords */
	tags?: string[];
	/** Language of the article (e.g., "en", "es") */
	lang?: string;
}

const {
	title,
	description,
	url,
	siteUrl,
	publishedTime,
	modifiedTime,
	image,
	tags,
	lang,
} = Astro.props;

const formattedPublishedTime = toISOWithTimezone(publishedTime);
const formattedModifiedTime = modifiedTime
	? toISOWithTimezone(modifiedTime)
	: undefined;

// Use the shared person entity for author and publisher
const personEntity = buildPersonEntity(siteUrl);

const jsonLd = {
	"@context": "https://schema.org",
	"@type": "BlogPosting",
	headline: title,
	description,
	url,
	image,
	datePublished: formattedPublishedTime,
	...(formattedModifiedTime && { dateModified: formattedModifiedTime }),
	...(tags && tags.length > 0 && { keywords: tags.join(", ") }),
	...(lang && { inLanguage: lang }),
	mainEntityOfPage: {
		"@type": "WebPage",
		"@id": url,
	},
	author: personEntity,
	publisher: personEntity,
};
---

<script type="application/ld+json" set:html={JSON.stringify(jsonLd)} />
