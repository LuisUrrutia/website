---
import type { ColorMode, ThemedIcon } from "@/types/icon";

interface Props {
	name: string;
	icon: string | ThemedIcon;
	colorMode?: ColorMode;
	experienceText: string;
	/** Image loading strategy. Use "eager" for above-the-fold items. */
	loading?: "lazy" | "eager";
	class?: string;
}

const {
	name,
	icon,
	colorMode = "keep",
	experienceText,
	loading = "lazy",
	class: className,
} = Astro.props;

const isThemedIcon = typeof icon === "object";
const iconSrc = isThemedIcon ? null : icon;
const lightIcon = isThemedIcon ? icon.light : null;
const darkIcon = isThemedIcon ? icon.dark : null;
const isAutoColor = !isThemedIcon && colorMode === "auto";
---

<div class:list={["flex items-center gap-3 p-2", className]}>
	<div class="relative size-12 shrink-0">
		{
			isThemedIcon ? (
				<>
					<img
						src={lightIcon}
						alt={`${name} logo`}
						class="tech-icon tech-icon-light absolute inset-0 size-12 object-contain"
						width="48"
						height="48"
						loading={loading}
						decoding="async"
					/>
					<img
						src={darkIcon}
						alt={`${name} logo`}
						class="tech-icon tech-icon-dark absolute inset-0 size-12 object-contain"
						width="48"
						height="48"
						loading={loading}
						decoding="async"
					/>
				</>
			) : (
				<img
					src={iconSrc}
					alt={`${name} logo`}
					class:list={[
						"size-12 object-contain",
						{ "tech-icon-auto": isAutoColor },
					]}
					width="48"
					height="48"
					loading={loading}
					decoding="async"
				/>
			)
		}
	</div>
	<div class="flex flex-col gap-0.5">
		<span class="text-title text-lg font-medium">{name}</span>
		<span class="text-subtitle text-sm">
			{experienceText}
		</span>
	</div>
</div>

<style>
	/* Default: show light icon, hide dark */
	.tech-icon-dark {
		display: none;
	}

	/* Dark theme: show dark icon, hide light */
	:global([data-theme="dark"]) .tech-icon-light {
		display: none;
	}

	:global([data-theme="dark"]) .tech-icon-dark {
		display: block;
	}

	/* Auto color mode: invert colors in dark theme */
	:global([data-theme="dark"]) .tech-icon-auto {
		filter: invert(1);
	}
</style>
