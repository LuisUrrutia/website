---
import type { HTMLTag } from "astro/types";
import IconArrowRight from "@/assets/icons/arrow-right.svg";
import Pill from "@/components/Pill.astro";
import { intlLocales } from "@/i18n";

type HeadingLevel = Extract<HTMLTag, "h1" | "h2" | "h3" | "h4" | "h5" | "h6">;

interface Props {
	title: string;
	category: string;
	categoryColor?: string;
	date: Date;
	href?: string;
	external?: boolean;
	readingTime?: string;
	"aria-label"?: string;
	locale?: string;
	dateFormat?: Intl.DateTimeFormatOptions;
	/** Unique slug for view transition name (enables title animation between pages) */
	slug?: string;
	/** Heading level for the title. Defaults to "h3". */
	headingLevel?: HeadingLevel;
}

const { lang } = Astro.locals;

const {
	title,
	category,
	categoryColor,
	date,
	href,
	external,
	readingTime,
	"aria-label": ariaLabel,
	locale = intlLocales[lang],
	dateFormat = { day: "numeric", month: "short", year: "numeric" },
	slug,
	headingLevel: Heading = "h3",
} = Astro.props;

// Generate unique transition names from slug (must be unique per page)
const titleTransitionName = slug ? `post-title-${slug}` : undefined;
const pillTransitionName = slug ? `post-pill-${slug}` : undefined;

const formattedDate = date.toLocaleDateString(locale, dateFormat);

const isoDate = date.toISOString().split("T")[0];

const Tag = href ? "a" : "div";

const linkProps = href
	? {
			href,
			...(external && { target: "_blank", rel: "noopener noreferrer" }),
			...(ariaLabel && { "aria-label": ariaLabel }),
		}
	: {};
---

<Tag
	{...linkProps}
	class="group relative flex flex-col gap-4 overflow-hidden md:flex-row md:pt-8"
>
	<div class="text-subtitle flex w-24 flex-col pt-8 text-sm md:pt-0">
		<time datetime={isoDate}>{formattedDate}</time>
		{readingTime && <span class="text-xs">{readingTime}</span>}
	</div>
	<div class="border-border flex-1 border-b pb-8">
		<div class="flex flex-col gap-3">
			<Pill
				color={categoryColor}
				style={pillTransitionName
					? `view-transition-name: ${pillTransitionName}`
					: undefined}>{category}</Pill
			>
			<Heading
				class="text-title text-lg font-medium md:text-xl"
				style={titleTransitionName
					? `view-transition-name: ${titleTransitionName}`
					: undefined}
			>
				{title}
			</Heading>
		</div>
	</div>
	{
		href && (
			<IconArrowRight
				class="text-subtitle absolute top-1/2 right-0 size-5 shrink-0 translate-x-2 -translate-y-1/2 opacity-0 transition-all duration-300 ease-out group-hover:translate-x-0 group-hover:opacity-100"
				aria-hidden="true"
			/>
		)
	}
</Tag>
