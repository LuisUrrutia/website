---
// Inline blocking script to prevent theme flash
// This runs before any rendering occurs and on view transitions
---

<script is:inline>
	function applyTheme() {
		const key = "theme";
		const stored = localStorage.getItem(key);
		const prefersDark = window.matchMedia(
			"(prefers-color-scheme: dark)",
		).matches;

		let theme;
		let mode;
		if (stored === "light" || stored === "dark") {
			theme = stored;
			mode = stored;
		} else {
			theme = prefersDark ? "dark" : "light";
			mode = "auto";
		}

		document.documentElement.dataset.theme = theme;
		document.documentElement.dataset.themeMode = mode;
	}

	// Apply on initial load
	applyTheme();

	// Apply after view transitions swap to prevent flash
	document.addEventListener("astro:after-swap", applyTheme);
</script>
