---
import { getImage } from "astro:assets";
import horizontalPhoto from "@/assets/images/me-horizontal.jpeg";
import verticalPhoto from "@/assets/images/me-vertical.jpeg";

interface Props {
	alt: string;
	class?: string;
}

const { alt, class: className } = Astro.props;

const HEIGHT = 252;
const VERTICAL_WIDTH = 205;

// Horizontal photo widths (below lg):
// - Below sm: max 552px container, above sm: max 600px
// - Srcset: 552px (1x xs), 600px (1x sm+), 1104px (2x xs), 1200px (2x sm+)
const HORIZONTAL_WIDTH = 600;
const HORIZONTAL_WIDTHS = [552, HORIZONTAL_WIDTH, 1104, 1200];

// Vertical photo widths (lg and above):
// - Fixed at VERTICAL_WIDTH across lg (1024px), xl (1280px), 2xl (1536px)
// - Srcset: 1x, 2x, 3x DPR variants
const VERTICAL_WIDTHS = [
	VERTICAL_WIDTH,
	VERTICAL_WIDTH * 2,
	VERTICAL_WIDTH * 3,
];

const [horizontalAvif, horizontalWebp, verticalAvif, verticalWebp] =
	await Promise.all([
		getImage({
			src: horizontalPhoto,
			height: HEIGHT,
			widths: HORIZONTAL_WIDTHS,
			format: "avif",
		}),
		getImage({
			src: horizontalPhoto,
			height: HEIGHT,
			widths: HORIZONTAL_WIDTHS,
			format: "webp",
		}),
		getImage({
			src: verticalPhoto,
			height: HEIGHT,
			widths: VERTICAL_WIDTHS,
			format: "avif",
		}),
		getImage({
			src: verticalPhoto,
			height: HEIGHT,
			widths: VERTICAL_WIDTHS,
			format: "webp",
		}),
	]);
---

<picture class:list={[className, "lg:max-w-[205px] lg:shrink-0"]}>
	{/* Mobile and md: horizontal photo */}
	<source
		type="image/avif"
		srcset={horizontalAvif.srcSet.attribute}
		media="(max-width: 1023px)"
		sizes="(max-width: 639px) 552px, 600px"
	/>
	<source
		type="image/webp"
		srcset={horizontalWebp.srcSet.attribute}
		media="(max-width: 1023px)"
		sizes="(max-width: 639px) 552px, 600px"
	/>
	{/* lg and above: vertical photo */}
	<source
		type="image/avif"
		srcset={verticalAvif.srcSet.attribute}
		media="(min-width: 1024px)"
		sizes={`${VERTICAL_WIDTH}px`}
	/>
	<source
		type="image/webp"
		srcset={verticalWebp.srcSet.attribute}
		media="(min-width: 1024px)"
		sizes={`${VERTICAL_WIDTH}px`}
	/>
	<img
		src={horizontalWebp.src}
		alt={alt}
		width={HORIZONTAL_WIDTH}
		height={HEIGHT}
		loading="eager"
		fetchpriority="high"
		class="h-[252px] w-full rounded-xl object-cover lg:w-[205px] lg:max-w-[205px] lg:shrink-0"
	/>
</picture>
