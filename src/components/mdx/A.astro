---
/**
 * Custom anchor component for MDX content.
 *
 * Automatically detects external links and adds:
 * - Security attributes (rel="noopener noreferrer", target="_blank")
 * - Visual indicator icon
 * - Screen reader accessible text "(opens in new tab)"
 */
import IconExternalLink from "@/assets/icons/external-link.svg";

interface Props extends astroHTML.JSX.AnchorHTMLAttributes {}

const SITE_DOMAIN = "urrutia.me";

const { href, class: className, ...rest } = Astro.props;
const { t } = Astro.locals;

const hrefString = typeof href === "string" ? href : href?.toString();
const isExternal =
	hrefString?.startsWith("http://") ||
	(hrefString?.startsWith("https://") && !hrefString?.includes(SITE_DOMAIN));

const externalProps = isExternal
	? {
			target: "_blank",
			rel: "noopener noreferrer",
			referrerpolicy: "strict-origin-when-cross-origin" as const,
		}
	: {};
---

<a href={href} class={className} {...externalProps} {...rest}>
	<slot />
	{
		isExternal && (
			<>
				<span class="sr-only">{t("a11y.opensInNewTab")}</span>
				<IconExternalLink
					class="ml-0.5 inline-block size-3 align-baseline opacity-70"
					aria-hidden="true"
				/>
			</>
		)
	}
</a>
