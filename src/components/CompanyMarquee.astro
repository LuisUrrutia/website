---
import type { Company } from "@/types/company";
import IconGitCommit from "@/assets/icons/git-commit.svg";

type Direction = "left" | "right";

interface Props {
	companies: Company[];
	label?: string;
	duration?: number;
	direction?: Direction;
}

const {
	companies,
	label = "Companies I've worked with",
	duration = 45,
	direction = "left",
} = Astro.props;
---

<div
	class="marquee-container"
	aria-roledescription="carousel"
	aria-label={label}
	style={`--marquee-duration: ${duration}s`}
>
	<!-- Visually hidden list for screen readers -->
	<ul class="sr-only">
		{
			companies.map((company) => (
				<li>
					<a href={company.url} target="_blank" rel="noopener noreferrer">
						{company.name}
					</a>
				</li>
			))
		}
	</ul>

	<!-- Visual marquee (hidden from screen readers) -->
	<div
		class:list={[
			"marquee-track",
			{ "marquee-track--reverse": direction === "right" },
		]}
		aria-hidden="true"
	>
		{
			[0, 1].map(() => (
				<div class="marquee-content">
					{companies.map((company, index) => (
						<>
							{index > 0 && <IconGitCommit class="marquee-separator" />}
							<a
								href={company.url}
								target="_blank"
								rel="noopener noreferrer"
								tabindex="-1"
								class="marquee-link"
							>
								<img
									src={company.logo}
									alt={`${company.name} logo`}
									class="marquee-logo"
									width={company.width}
									height="28"
									loading="lazy"
									decoding="async"
								/>
							</a>
						</>
					))}
					<IconGitCommit class="marquee-separator" />
				</div>
			))
		}
	</div>
</div>

<style>
	.marquee-container {
		position: relative;
		overflow: hidden;
		-webkit-mask-image: linear-gradient(
			to right,
			transparent,
			black 5%,
			black 95%,
			transparent
		);
		mask-image: linear-gradient(
			to right,
			transparent,
			black 5%,
			black 95%,
			transparent
		);
	}

	.marquee-track {
		display: flex;
		width: max-content;
		animation: marquee var(--marquee-duration) linear infinite;
		transform: translateZ(0);
		will-change: transform;
	}

	.marquee-track--reverse {
		animation-direction: reverse;
	}

	.marquee-container:hover .marquee-track {
		animation-play-state: paused;
	}

	.marquee-content {
		display: flex;
		align-items: center;
		gap: 2rem;
		padding-right: 2rem;
	}

	.marquee-link {
		display: block;
		opacity: 0.7;
		transition: opacity 0.2s ease;
	}

	.marquee-link:hover {
		opacity: 1;
	}

	.marquee-logo {
		height: 1.75rem;
		width: auto;
	}

	.marquee-separator {
		color: var(--color-separator, oklch(78% 0.06 270));
		flex-shrink: 0;
	}

	@keyframes marquee {
		from {
			transform: translateX(0);
		}
		to {
			transform: translateX(-50%);
		}
	}

	@media (prefers-reduced-motion: reduce) {
		.marquee-track {
			animation: none;
		}
	}
</style>
