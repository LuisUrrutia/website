---
import IconChevronLeft from "@/assets/icons/chevron-left.svg";
import IconChevronRight from "@/assets/icons/chevron-right.svg";

interface Props {
	currentPage: number;
	totalPages: number;
	baseUrl: string;
	class?: string;
}

const { currentPage, totalPages, baseUrl, class: className } = Astro.props;
const { t } = Astro.locals;

// Generate page numbers to show
function getPageNumbers(current: number, total: number): (number | "...")[] {
	if (total <= 7) {
		return Array.from({ length: total }, (_, i) => i + 1);
	}

	const pages: (number | "...")[] = [];

	// Always show first page
	pages.push(1);

	if (current > 3) {
		pages.push("...");
	}

	// Show pages around current
	for (
		let i = Math.max(2, current - 1);
		i <= Math.min(total - 1, current + 1);
		i++
	) {
		pages.push(i);
	}

	if (current < total - 2) {
		pages.push("...");
	}

	// Always show last page
	if (total > 1) {
		pages.push(total);
	}

	return pages;
}

const pageNumbers = getPageNumbers(currentPage, totalPages);

function getPageUrl(page: number): string {
	if (page === 1) {
		return baseUrl;
	}
	return `${baseUrl}/page/${page}`;
}
---

{
	totalPages > 1 && (
		<nav
			class:list={["flex items-center justify-center gap-2", className]}
			aria-label={t("a11y.pagination")}
		>
			{/* Previous button */}
			{currentPage > 1 ? (
				<a
					href={getPageUrl(currentPage - 1)}
					class="text-subtitle hover:text-title rounded-lg px-3 py-2 transition-colors hover:bg-white/5"
					aria-label={t("pagination.previous")}
				>
					<IconChevronLeft class="size-5" />
				</a>
			) : (
				<span
					class="text-subtitle/50 cursor-not-allowed px-3 py-2"
					aria-disabled="true"
					aria-label={t("pagination.previous")}
				>
					<IconChevronLeft class="size-5" aria-hidden="true" />
				</span>
			)}

			{/* Page numbers */}
			{pageNumbers.map((page) =>
				page === "..." ? (
					<span class="text-subtitle px-2" aria-hidden="true">
						...
					</span>
				) : page === currentPage ? (
					<span
						class="bg-accent min-w-[2.5rem] rounded-lg px-3 py-2 text-center font-medium text-white"
						aria-current="page"
					>
						{page}
					</span>
				) : (
					<a
						href={getPageUrl(page)}
						class="text-subtitle hover:text-title min-w-[2.5rem] rounded-lg px-3 py-2 text-center transition-colors hover:bg-white/5"
					>
						{page}
					</a>
				),
			)}

			{/* Next button */}
			{currentPage < totalPages ? (
				<a
					href={getPageUrl(currentPage + 1)}
					class="text-subtitle hover:text-title rounded-lg px-3 py-2 transition-colors hover:bg-white/5"
					aria-label={t("pagination.next")}
				>
					<IconChevronRight class="size-5" />
				</a>
			) : (
				<span
					class="text-subtitle/50 cursor-not-allowed px-3 py-2"
					aria-disabled="true"
					aria-label={t("pagination.next")}
				>
					<IconChevronRight class="size-5" aria-hidden="true" />
				</span>
			)}
		</nav>
	)
}
