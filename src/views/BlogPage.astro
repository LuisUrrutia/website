---
import type { CollectionEntry } from "astro:content";
import Layout from "@/layouts/Layout.astro";
import Navbar from "@/components/Navbar.astro";
import Container from "@/components/Container.astro";
import Card from "@/components/Card.astro";
import BlogEntry from "@/components/BlogEntry.astro";
import Pagination from "@/components/Pagination.astro";
import { BreadcrumbJsonLd } from "@/components/seo";
import { getLocalizedPath, getSlugWithoutLocale } from "@/i18n";
import { getSiteUrl } from "@/lib/formatters";

interface Props {
	posts: CollectionEntry<"blog">[];
	currentPage: number;
	totalPages: number;
}

const { posts, currentPage, totalPages } = Astro.props;
const { t, lang } = Astro.locals;

const siteUrl = getSiteUrl(Astro);

// Breadcrumb items for blog listing page
const breadcrumbItems = [
	{
		name: t("breadcrumb.home"),
		url: `${siteUrl}${getLocalizedPath("/", lang)}`,
	},
	{
		name: t("breadcrumb.blog"),
		url: `${siteUrl}${getLocalizedPath("/blog", lang)}`,
	},
];

// Helper to get the post URL
function getPostUrl(id: string): string {
	const slug = getSlugWithoutLocale(id);
	return getLocalizedPath(`/blog/${slug}`, lang);
}

// Base URL for pagination
const baseUrl = getLocalizedPath("/blog", lang);
---

<Layout title={t("blog.pageTitle")} description={t("blog.pageDescription")}>
	<BreadcrumbJsonLd slot="head" items={breadcrumbItems} />
	<Navbar />
	<Container
		as="main"
		id="main-content"
		class="flex flex-col gap-8"
		transition:animate="slide"
	>
		<Card style="view-transition-name: post-card">
			<header class="mb-6">
				<h1 class="text-title text-3xl font-bold">{t("blog.heading")}</h1>
				<p class="text-subtitle mt-2">{t("blog.pageDescription")}</p>
			</header>

			{
				posts.length === 0 ? (
					<p class="text-subtitle py-8 text-center">{t("blog.empty")}</p>
				) : (
					<ul class="m-0 flex list-none flex-col p-0">
						{posts.map((post, index) => (
							<li>
								<BlogEntry
									title={post.data.title}
									category={post.data.category}
									date={post.data.date}
									href={getPostUrl(post.id)}
									slug={getSlugWithoutLocale(post.id)}
									headingLevel="h2"
									hideBorder={index === posts.length - 1}
								/>
							</li>
						))}
					</ul>
				)
			}

			<Pagination
				currentPage={currentPage}
				totalPages={totalPages}
				baseUrl={baseUrl}
				class="mt-8"
			/>
		</Card>
	</Container>
</Layout>
